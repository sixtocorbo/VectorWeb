@inherits LayoutComponentBase
@implements IDisposable
@inject NavigationManager Navigation

<div class="page @(isMenuVisible ? "menu-visible" : "menu-hidden")">
    <button class="menu-toggle btn btn-dark" type="button" @onclick="ToggleMenu" aria-label="Mostrar u ocultar menÃº">
        <i class="bi bi-list"></i>
    </button>

    <div class="menu-hover-zone" @onmouseenter="ShowMenu" aria-hidden="true"></div>

    <div class="sidebar" @onmouseenter="ShowMenu" @onmouseleave="HideMenu">
        <NavMenu />
    </div>

    <main @onclick="HideMenuOnContentInteraction">
        <div class="top-row px-4"></div>

        <article class="content px-4">
            @Body
        </article>
    </main>
</div>

<div id="blazor-error-ui">
    An unhandled error has occurred.
    <a href="" class="reload">Reload</a>
    <a class="dismiss">ðŸ—™</a>
</div>

@code {
    private bool isMenuVisible;

    protected override void OnInitialized()
    {
        Navigation.LocationChanged += OnLocationChanged;
    }

    private void OnLocationChanged(object? sender, LocationChangedEventArgs e)
    {
        isMenuVisible = false;
        InvokeAsync(StateHasChanged);
    }

    private void ToggleMenu()
    {
        isMenuVisible = !isMenuVisible;
    }

    private void ShowMenu()
    {
        if (!isMenuVisible)
        {
            isMenuVisible = true;
        }
    }

    private void HideMenu()
    {
        if (isMenuVisible)
        {
            isMenuVisible = false;
        }
    }

    private void HideMenuOnContentInteraction()
    {
        if (isMenuVisible)
        {
            isMenuVisible = false;
        }
    }

    public void Dispose()
    {
        Navigation.LocationChanged -= OnLocationChanged;
    }
}
